
# Keychains AI Key Scanner & Rotator

This project provides a powerful command-line tool with two primary functions:
1.  **Scan Mode:** A professional-grade script that concurrently scans public GitHub repositories for exposed AI API keys.
2.  **Rotate Mode:** A utility to fetch a single, validated, working API key from a pool of previously found keys, for use in other applications.

**DISCLAIMER:** This tool searches public data on GitHub. Use it responsibly. The goal is to find and help fix security vulnerabilities, not to exploit them. Using API keys that do not belong to you is against the terms of service of most providers and may be illegal.

---

## Mode 1: Scanning for Leaks (`scan` command)

This is the core discovery engine. It's a command-line script you run on your computer to find API keys. It's designed for speed and accuracy, featuring:
-   **Concurrent Scanning:** Scans for multiple key types at once using multi-threading.
-   **Regex Validation:** Validates the format of potential keys to drastically reduce false positives.
-   **State Management:** Remembers leaks it has already found to avoid duplicate reports.
-   **Professional Logging:** Provides clean, color-coded output and can save detailed logs to a file.

### Prerequisites
- Python 3.7+ installed on your machine.
- A GitHub account.

### Step 1: Get a GitHub Personal Access Token (PAT)

The script needs a GitHub token to talk to the GitHub API.

1.  Go to **[github.com/settings/tokens](https://github.com/settings/tokens)**.
2.  Click **"Generate new token"** and select **"Generate new token (classic)"**.
3.  Give your token a name (e.g., "KeychainsScanner").
4.  Set an expiration date.
5.  Under **"Select scopes"**, check the **`public_repo`** scope. This is all that's needed for reading public code.
6.  Click **"Generate token"**.
7.  **IMPORTANT:** Copy your new token immediately. You won't be able to see it again!

### Step 2: Set the Environment Variable

For security, use an environment variable to store your token.

**On macOS / Linux:**
```bash
export GITHUB_TOKEN="your_token_here"
```
*(Note: Add this to your `~/.zshrc` or `~/.bashrc` to make it permanent.)*

**On Windows (Command Prompt):**
```cmd
set GITHUB_TOKEN="your_token_here"
```

### Step 3: Install Dependencies
```bash
pip install requests
```

### Step 4: Run the Scanner

**Basic Scan (all services):**
This will run the scanner and print all confirmed new leaks to your terminal.
```bash
python keychains.py scan
```

**Saving Results to a File:**
This is the recommended way to use the scanner, as the output file is used by the `rotate` command.
```bash
python keychains.py scan --output findings.json
```

### Advanced Scanning Usage

**Scan for Specific Services:**
```bash
python keychains.py scan --services OpenAI,Cohere
```

**Exclude Forks and Save a Log File:**
```bash
python keychains.py scan --no-forks --log-file keychains.log
```

---

## Mode 2: Rotating API Keys (`rotate` command)

This mode turns Keychains into a key provider for your other applications. It reads a file of potential keys (generated by the `scan` command), finds one that is currently active and not rate-limited, and prints it for your program to use.

### **IMPORTANT: ETHICAL WARNING**
The `rotate` feature is intended for educational purposes or for rotating keys that you are **authorized to use**. Using API keys found on public GitHub that do not belong to you is a violation of most providers' terms of service and may be illegal. **Use this feature responsibly and at your own risk.**

### How it Works
1.  You run `python keychains.py scan --output findings.json` to create a pool of potential keys.
2.  Your application, when it needs a key (or its current key fails), calls the `rotate` command.
3.  The `rotate` command reads `findings.json`, finds the first key for the specified service that passes a live validation check, and prints *only the key string* to standard output.
4.  Your application captures this output and uses the new key.

### Usage Example

Let's say you have another Python script, `my_app.py`, that needs an OpenAI API key. You can dynamically provide one like this from your shell:

```bash
# 1. Run the scan to populate your key file
python keychains.py scan --output findings.json

# 2. Run your app, injecting a validated key as an environment variable
export OPENAI_API_KEY=$(python keychains.py rotate --service OpenAI --key-file findings.json)

# 3. Check if the key was set and then run your app
if [ -n "$OPENAI_API_KEY" ]; then
    echo "Successfully fetched a new OpenAI key. Starting app..."
    python my_app.py
else
    echo "Failed to fetch a working OpenAI key."
fi
```

### `rotate` Command Arguments
-   `--service <SERVICE>`, `-s <SERVICE>`: (Required) The service you need a key for. e.g., `OpenAI`.
-   `--key-file <FILENAME>`, `-k <FILENAME>`: The JSON file to read keys from. Defaults to `findings.json`.
